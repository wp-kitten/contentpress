/*! For license information please see modal.js.LICENSE.txt */
(()=>{var a=void 0!==window.MediaLocale&&window.MediaLocale;if(!a)throw new Error("MediaLocale locale not loaded.");jQuery((function(e){"use strict";var n=window.AppLocale,t=e("#mediaModal"),i=null,s=null,o=!1,d=function(a,n){i=e(n.data("imageTarget")),s=e(n.data("inputTarget")),e(".js-valpress-thumbnail",a).on("click",(function(a){a.preventDefault(),a.stopPropagation();var n=e(this),t=e("img",n);s.val(n.data("id")),i.attr("src",t.attr("src")).removeClass("hidden")}))};e(".js-preview-image-delete").on("click",(function(a){a.preventDefault(),a.stopPropagation();var n=e(this).parents(".js-image-preview");e('input[type="hidden"]',n).val(""),e("img",n).addClass("hidden").attr("src","")}));var r=!1,l=new DropifyImageUploader(e("#dropify_image_field"));t.on("show.bs.modal",(function(t){var c=e(t.relatedTarget),m=e(this),_=m.find(".modal-body").find(".js-content"),p=_.find(".valpress-media-list");m.find(".modal-title").text(a.text_media),o||(d(m,c),o=!0),_.removeClass("hidden"),r||(l.setup({on_add_image:function(t){var o=t.element[0].files[0];if(o.length<1)return!1;var r=new FormData;r.append("action","media_upload_image"),r.append("media_image",o),r.append(n.nonce_name,n.nonce_value),e.ajax({url:n.ajax.url,method:"POST",async:!0,timeout:29e3,data:r,processData:!1,contentType:!1}).done((function(e){if(e)if(e.success)if(e.data){t.ajaxResponse=e.data;var o='<div class="item js--item" data-id="__FILE_ID__">\n<a href="#" class="js-valpress-thumbnail thumbnail" data-id="__FILE_ID__">\n     <img src="__FILE_URL__" alt="" class="valpress-thumbnail"/>\n</a>\n</div>';o=o.replace(/__FILE_ID__/g,e.data.id).replace("__FILE_URL__",e.data.url),p.prepend(o),p.find(".js--info").addClass("hidden"),d(p,c),s.val(e.data.id),i.attr("src",e.data.url).removeClass("hidden"),showToast(a.text_image_set,"success")}else showToast(n.ajax.empty_response,"warning");else e.data?showToast(e.data,"warning"):showToast(n.ajax.empty_response,"warning");else showToast(n.ajax.no_response,"error")})).fail((function(a,e,n){showToast(n,"error")}))},on_remove_image:function(t){var o,d,r;e.ajax({url:n.ajax.url,method:"POST",async:!0,timeout:29e3,data:(o={action:"modal_delete_image",id:t.ajaxResponse.id},d=n.nonce_name,r=n.nonce_value,d in o?Object.defineProperty(o,d,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[d]=r,o)}).done((function(o){if(o)if(o.success){if(t.ajaxResponse.id){var d=e('.js--item[data-id="'+t.ajaxResponse.id+'"]',p);d&&d.remove(),s.val(""),i.addClass("hidden").attr("src","");var r=p.find(".js--item");(!r||r.length<1)&&p.find(".js--info").removeClass("hidden")}showToast(a.text_image_removed,"success")}else o.data?showToast(o.data,"warning"):showToast(n.ajax.empty_response,"warning");else showToast(n.ajax.no_response,"error")})).fail((function(a,e,n){showToast(n,"error")}))}}),r=!0)})).on("hidden.bs.modal",(function(a){var n=e("#dropify_image_field").dropify();(n=n.data("dropify")).resetPreview()}))}))})();